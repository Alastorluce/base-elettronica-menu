function setupAutoScroll(el, speed = 20, delay = 3000) {
  let id, last, active = false;

  // NASCONDI subito la scrollbar, anche prima di partire
  el.classList.add('auto-scroll-hide');
  el.classList.remove('auto-scroll-show');

  function step(ts) {
    if (!active) return;
    if (!last) last = ts;
    const d = ts - last; 
    last = ts;
    el.scrollTop += (d * speed) / 1000;
    if (el.scrollTop + el.clientHeight >= el.scrollHeight) return stop();
    id = requestAnimationFrame(step);
  }

  function start() {
    if (active) return;
    active = true;
    last = null;
    // già nascosta in apertura, ma ripeti per sicurezza
    el.classList.add('auto-scroll-hide');
    el.classList.remove('auto-scroll-show');
    id = requestAnimationFrame(step);
  }

  function stop() {
    if (!active) return;
    active = false;
    cancelAnimationFrame(id);
    el.classList.remove('auto-scroll-hide');
    el.classList.add('auto-scroll-show');
  }

  // toggle start/stop al click/touch
  el.addEventListener('click', () => active ? stop() : start());
  el.addEventListener('touchstart', () => active ? stop() : start());

  // parte in automatico dopo il delay
  setTimeout(start, delay);
}

// Inizializzazione minimal: se scrollabile, setta l’autoscroll
function initScrollOn(root) {
  if (isScrollable(root)) setupAutoScroll(root);
}
